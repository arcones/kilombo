import json
from unittest import TestCase

from kilombo.service.ncbi import _extract_accessions_from_summaries
from kilombo.service.ncbi import get_study_accession_list


class Test(TestCase):
    def test__extract_accession_from_summaries_short_study_summaries(self):
        with open("./fixtures/6_study_summaries.json") as file:
            study_summaries = json.load(file)
        accessions = []
        for study_summary in study_summaries:
            accessions.append(_extract_accessions_from_summaries(study_summaries[study_summary]))
        assert len(accessions) == 6
        assert accessions == ["GSE207275", "GSE189432", "GSE167593", "GSE174574", "GSE126815", "GSE150644"]

    def test__extract_accession_from_summaries_long_study_summaries(self):
        with open("./fixtures/202_study_summaries.json") as file:
            study_summaries = json.load(file)
        accessions = []
        for study_summary in study_summaries:
            study_accession = _extract_accessions_from_summaries(study_summaries[study_summary])
            if study_accession is not None:
                accessions.append(study_accession)
        assert len(accessions) == 202
        assert accessions == [
            "GSE239626",
            "GSE181952",
            "GSE195874",
            "GSE239874",
            "GSE239873",
            "GSE236464",
            "GSE236805",
            "GSE233951",
            "GSE224377",
            "GSE229375",
            "GSE231833",
            "GSE227954",
            "GSE212147",
            "GSE223137",
            "GSE225410",
            "GSE204769",
            "GSE204755",
            "GSE210776",
            "GSE180761",
            "GSE180760",
            "GSE180755",
            "GSE225254",
            "GSE144830",
            "GSE217431",
            "GSE221042",
            "GSE216028",
            "GSE216027",
            "GSE216026",
            "GSE161196",
            "GSE84424",
            "GSE163338",
            "GSE215819",
            "GSE215818",
            "GSE215817",
            "GSE207601",
            "GSE156742",
            "GSE209656",
            "GSE211739",
            "GSE210147",
            "GSE205291",
            "GSE203046",
            "GSE201391",
            "GSE201390",
            "GSE193770",
            "GSE168527",
            "GSE190289",
            "GSE184098",
            "GSE193240",
            "GSE193238",
            "GSE193236",
            "GSE173187",
            "GSE173182",
            "GSE173790",
            "GSE173789",
            "GSE188320",
            "GSE188152",
            "GSE188097",
            "GSE188022",
            "GSE187953",
            "GSE187897",
            "GSE187887",
            "GSE187883",
            "GSE187868",
            "GSE187863",
            "GSE187816",
            "GSE187807",
            "GSE187719",
            "GSE187718",
            "GSE187642",
            "GSE187607",
            "GSE187586",
            "GSE187539",
            "GSE187510",
            "GSE187459",
            "GSE187360",
            "GSE187340",
            "GSE187296",
            "GSE187218",
            "GSE187169",
            "GSE187164",
            "GSE187162",
            "GSE187137",
            "GSE186895",
            "GSE174083",
            "GSE177046",
            "GSE169216",
            "GSE166675",
            "GSE178085",
            "GSE141980",
            "GSE168288",
            "GSE172476",
            "GSE172475",
            "GSE130177",
            "GSE169189",
            "GSE161654",
            "GSE139006",
            "GSE159035",
            "GSE159033",
            "GSE163005",
            "GSE142086",
            "GSE142085",
            "GSE156902",
            "GSE133028",
            "GSE134895",
            "GSE146294",
            "GSE145044",
            "GSE129774",
            "GSE129773",
            "GSE143320",
            "GSE144496",
            "GSE138614",
            "GSE125581",
            "GSE128615",
            "GSE121703",
            "GSE130975",
            "GSE127969",
            "GSE122353",
            "GSE104899",
            "GSE104898",
            "GSE104897",
            "GSE110525",
            "GSE114652",
            "GSE113973",
            "GSE84699",
            "GSE94730",
            "GSE91387",
            "GSE79014",
            "GSE77598",
            "GSE66763",
            "GSM6500415",
            "GSM6500414",
            "GSM6500413",
            "GSM6500412",
            "GSM5278558",
            "GSM5278557",
            "GSM5278556",
            "GSM5278555",
            "GSM5278554",
            "GSM5278553",
            "GSM5278552",
            "GSM5278551",
            "GSM5278550",
            "GSM5278549",
            "GSM5278548",
            "GSM5278547",
            "GSM5278546",
            "GSM5278545",
            "GSM5278544",
            "GSM5278543",
            "GSM5278542",
            "GSM5278541",
            "GSM5278540",
            "GSM5278539",
            "GSM5278538",
            "GSM5278537",
            "GSM5278536",
            "GSM5671100",
            "GSM5670191",
            "GSM5670041",
            "GSM5669903",
            "GSM5669794",
            "GSM5669773",
            "GSM5669766",
            "GSM5669722",
            "GSM5669714",
            "GSM5669613",
            "GSM5669598",
            "GSM5669376",
            "GSM5669375",
            "GSM5669118",
            "GSM5669022",
            "GSM5668979",
            "GSM5668862",
            "GSM5668694",
            "GSM5668540",
            "GSM5668048",
            "GSM5667955",
            "GSM5667779",
            "GSM5667593",
            "GSM5667499",
            "GSM5667493",
            "GSM5667490",
            "GSM5667448",
            "GSM4970060",
            "GSM4970059",
            "GSM4970058",
            "GSM4970057",
            "GSM4970074",
            "GSM4970073",
            "GSM4970072",
            "GSM4970071",
            "GSM4970070",
            "GSM1631680",
            "GSM1631679",
            "GSM1631678",
            "GSM1631677",
            "GSM1631676",
            "GSM1631675",
            "GSM1631674",
            "GSM1631673",
            "GSM1631672",
            "GSM1631671",
        ]


def test_get_study_accession_list():
    with open("./fixtures/202_study_summaries.json") as file:
        study_summaries = json.load(file)
    study_accession_list = get_study_accession_list(study_summaries)
    assert len(study_accession_list) == 129
    assert study_accession_list == {
        "200066763": "GSE66763",
        "200077598": "GSE77598",
        "200079014": "GSE79014",
        "200084424": "GSE84424",
        "200084699": "GSE84699",
        "200091387": "GSE91387",
        "200094730": "GSE94730",
        "200104897": "GSE104897",
        "200104898": "GSE104898",
        "200104899": "GSE104899",
        "200110525": "GSE110525",
        "200113973": "GSE113973",
        "200114652": "GSE114652",
        "200121703": "GSE121703",
        "200122353": "GSE122353",
        "200125581": "GSE125581",
        "200127969": "GSE127969",
        "200128615": "GSE128615",
        "200129773": "GSE129773",
        "200129774": "GSE129774",
        "200130177": "GSE130177",
        "200130975": "GSE130975",
        "200133028": "GSE133028",
        "200134895": "GSE134895",
        "200138614": "GSE138614",
        "200139006": "GSE139006",
        "200141980": "GSE141980",
        "200142085": "GSE142085",
        "200142086": "GSE142086",
        "200143320": "GSE143320",
        "200144496": "GSE144496",
        "200144830": "GSE144830",
        "200145044": "GSE145044",
        "200146294": "GSE146294",
        "200156742": "GSE156742",
        "200156902": "GSE156902",
        "200159033": "GSE159033",
        "200159035": "GSE159035",
        "200161196": "GSE161196",
        "200161654": "GSE161654",
        "200163005": "GSE163005",
        "200163338": "GSE163338",
        "200166675": "GSE166675",
        "200168288": "GSE168288",
        "200168527": "GSE168527",
        "200169189": "GSE169189",
        "200169216": "GSE169216",
        "200172475": "GSE172475",
        "200172476": "GSE172476",
        "200173182": "GSE173182",
        "200173187": "GSE173187",
        "200173789": "GSE173789",
        "200173790": "GSE173790",
        "200174083": "GSE174083",
        "200177046": "GSE177046",
        "200178085": "GSE178085",
        "200180755": "GSE180755",
        "200180760": "GSE180760",
        "200180761": "GSE180761",
        "200181952": "GSE181952",
        "200184098": "GSE184098",
        "200186895": "GSE186895",
        "200187137": "GSE187137",
        "200187162": "GSE187162",
        "200187164": "GSE187164",
        "200187169": "GSE187169",
        "200187218": "GSE187218",
        "200187296": "GSE187296",
        "200187340": "GSE187340",
        "200187360": "GSE187360",
        "200187459": "GSE187459",
        "200187510": "GSE187510",
        "200187539": "GSE187539",
        "200187586": "GSE187586",
        "200187607": "GSE187607",
        "200187642": "GSE187642",
        "200187718": "GSE187718",
        "200187719": "GSE187719",
        "200187807": "GSE187807",
        "200187816": "GSE187816",
        "200187863": "GSE187863",
        "200187868": "GSE187868",
        "200187883": "GSE187883",
        "200187887": "GSE187887",
        "200187897": "GSE187897",
        "200187953": "GSE187953",
        "200188022": "GSE188022",
        "200188097": "GSE188097",
        "200188152": "GSE188152",
        "200188320": "GSE188320",
        "200190289": "GSE190289",
        "200193236": "GSE193236",
        "200193238": "GSE193238",
        "200193240": "GSE193240",
        "200193770": "GSE193770",
        "200195874": "GSE195874",
        "200201390": "GSE201390",
        "200201391": "GSE201391",
        "200203046": "GSE203046",
        "200204755": "GSE204755",
        "200204769": "GSE204769",
        "200205291": "GSE205291",
        "200207601": "GSE207601",
        "200209656": "GSE209656",
        "200210147": "GSE210147",
        "200210776": "GSE210776",
        "200211739": "GSE211739",
        "200212147": "GSE212147",
        "200215817": "GSE215817",
        "200215818": "GSE215818",
        "200215819": "GSE215819",
        "200216026": "GSE216026",
        "200216027": "GSE216027",
        "200216028": "GSE216028",
        "200217431": "GSE217431",
        "200221042": "GSE221042",
        "200223137": "GSE223137",
        "200224377": "GSE224377",
        "200225254": "GSE225254",
        "200225410": "GSE225410",
        "200227954": "GSE227954",
        "200229375": "GSE229375",
        "200231833": "GSE231833",
        "200233951": "GSE233951",
        "200236464": "GSE236464",
        "200236805": "GSE236805",
        "200239626": "GSE239626",
        "200239873": "GSE239873",
        "200239874": "GSE239874",
    }
